
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Iris build log &#8212; kuenishi(7)</title>
    <link rel="stylesheet" href="../_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ErgoDox EZ" href="ergodox-ez.html" />
    <link rel="prev" title="ZFS Memo" href="zfs.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="../_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ergodox-ez.html" title="ErgoDox EZ"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="zfs.html" title="ZFS Memo"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">kuenishi(7)</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="iris-build-log">
<h1>Iris build log<a class="headerlink" href="#iris-build-log" title="Permalink to this headline">¶</a></h1>
<p>Build firmware:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone git://github.com/qmk/qmk_firmware.git
$ cd qmk_firmware
$ make submodule
$ make iris/rev2:avrdude
</pre></div>
</div>
<p>avr-gcc 8.2.0 has a bug: <a class="reference external" href="https://github.com/qmk/qmk_firmware/issues/3657">https://github.com/qmk/qmk_firmware/issues/3657</a></p>
<p>The workaround is build the firmware in some container such as Docker,
and write the firmware by yourself, not using make command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ls /dev/tty.usbmodem*
tty.usbmodem1432301
$ avrdude -p atmega32u4 -c avr109 -P /dev/tty.usbmodem1432301 -U flash:w:iris_rev2_default.hex
</pre></div>
</div>
<p>Make sure you have <code class="docutils literal notranslate"><span class="pre">iris_rev2_default.hex</span></code> in the current
directory. Maybe you might have to reset the Pro Micro by
shorting the <code class="docutils literal notranslate"><span class="pre">RST</span></code> and <code class="docutils literal notranslate"><span class="pre">GND</span></code>.</p>
<div class="section" id="built-without-led">
<h2>Built without LED<a class="headerlink" href="#built-without-led" title="Permalink to this headline">¶</a></h2>
<p>All below was made with <a class="reference external" href="https://www.aliexpress.com/item/Free-Shipping-New-Pro-Micro-for-arduino-ATmega32U4-5V-16MHz-Module-with-2-row-pin-header/2021987137.html?spm=a2g0s.9042311.0.0.34124c4diC0nIN">this Pro Micro</a>
which seem very stable. Also I bought <a class="reference external" href="https://www.aliexpress.com/item/Gateron-mx-switch-3-pin-and-5-pin-transparent-case-mx-green-brown-blue-switches-for/32835653175.html?spm=a2g0s.9042311.0.0.27424c4d7W0QUU">cherry mx compatible switch</a> , red and clear.</p>
<p><a class="reference external" href="https://www.instagram.com/p/Bq5P7nDANwt/">https://www.instagram.com/p/Bq5P7nDANwt/</a></p>
<img alt="First success!" class="align-center" src="../_images/IMG_20181203_030909.jpg" />
<p><a class="reference external" href="https://www.instagram.com/p/BrDYypKAexl/">https://www.instagram.com/p/BrDYypKAexl/</a></p>
<ul class="simple">
<li>Keycaps : <a class="reference external" href="https://www.aliexpress.com/item/DSA-50-dye-sub-keycaps-for-cherry-mx-switch/32879946574.html">https://www.aliexpress.com/item/DSA-50-dye-sub-keycaps-for-cherry-mx-switch/32879946574.html</a></li>
</ul>
<img alt="Second success!" class="align-center" src="../_images/IMG_20181207_013803.jpg" />
</div>
<div class="section" id="low-profile">
<h2>Low Profile<a class="headerlink" href="#low-profile" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://www.instagram.com/p/Brxmfixg7wA/">Lessons learned</a></li>
<li><a class="reference external" href="https://www.aliexpress.com/item/kailh-low-profile-switch-half-high-ultrathin-RGB-Swithes-For-Backlit-Mechanical-Gaming-keyboard-brown-white/32838369089.html?spm=a2g0s.9042311.0.0.34124c4diC0nIN">Low profile key switches</a></li>
<li><a class="reference external" href="https://www.aliexpress.com/item/kailh-choc-low-profile-keycap-set-for-kailh-low-profile-swtich-abs-doubleshot-ultra-thin-keycap/32915900901.html?spm=a2g0s.9042311.0.0.34124c4diC0nIN">Low profile keycaps</a></li>
</ul>
<img alt="First success on low profile" class="align-center" src="../_images/IMG_20181225_001333.jpg" />
</div>
<div class="section" id="lighting-with-led">
<h2>Lighting with LED<a class="headerlink" href="#lighting-with-led" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://keeb.io/products/iris-keyboard-split-ergonomic-keyboard?variant=8034004860958">Iris originally requires</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Optional</span> <span class="o">-</span> <span class="n">LED</span> <span class="n">support</span> <span class="n">components</span>

  <span class="mi">2</span> <span class="n">AO3416</span> <span class="n">MOSFETs</span>
  <span class="mi">2</span> <span class="mf">4.7</span><span class="n">kΩ</span> <span class="n">resistors</span>

<span class="n">Optional</span> <span class="o">-</span> <span class="n">LEDs</span> <span class="ow">and</span> <span class="mi">470</span><span class="n">Ω</span> <span class="n">resistors</span>
</pre></div>
</div>
<p>But they’re not included in the kit so I seeked for them in Akihabara, in 2018/12/28 . And found:</p>
<ul class="simple">
<li>100PCS 1/4w 470Ω resistors 金属被覆 &#64; 300JPY x2</li>
<li>10PCS Nch MOSFET IRFML8244TRPBFTR &#64; 160JPY</li>
<li>10PCS Nch MOSFET IRLML6344TRPBFTR &#64; 240JPY</li>
<li><a class="reference external" href="https://www.sengoku.co.jp/mod/sgk_cart/detail.php?code=EEHD-00GP">10PCS 角形2.3.4 赤色LED 輝度:1000～1500mcd 指向角:120° 波長:625～630nm 順電圧:1.9～2.3V 順電流:30mA</a> &#64; 500JPY</li>
<li>10PCS 角形2.3.4 白色LED 輝度:1000～1500mcd 指向角:120° 波長:590～595nm 順電圧:1.9～2.3V 順電圧:30mA &#64; 500JPY</li>
<li>10PCS 角形2.3.4 青色LED 輝度:1000～1500mcd 指向角:120° 波長:590～595nm 順電圧:1.9～2.3V 順電圧:30mA &#64; 500JPY</li>
<li><a class="reference external" href="https://www.sengoku.co.jp/mod/sgk_cart/detail.php?code=EEHD-00GS">10PCS 角形2.3.4 緑色LED 輝度:1000～1500mcd 指向角:120° 波長:590～595nm 順電圧:1.9～2.3V 順電圧:30mA</a> &#64; 500JPY</li>
</ul>
<p>First Combination I tried was:</p>
<ul class="simple">
<li>1/4w 470Ω resistors 金属被覆</li>
<li>Nch MOSFET IRFML8244TRPBFTR</li>
<li>角形2.3.4 緑色LED</li>
</ul>
<p>The LED lighted but not that bright and hard to recognize even in
darkness. So I doubted the MOSFET as it’s different from required one,
and changed to Nch MOSFET IRLML6344TRPBFTR - but didn’t worked well
thought the key typing itself worked very fine.</p>
<img alt="Only two LEDs are implemented" class="align-center" src="../_images/IMG_20181228_220815.jpg" />
<p>On 2018/12/30 I tried buying <a class="reference external" href="https://www.sengoku.co.jp/mod/sgk_cart/detail.php?code=EEHD-00GS">another LED</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>順電圧:3.0～3.4V
順電流:20mA
1500～2500mcd
指向角:120°
波長:515～521nm
</pre></div>
</div>
<p>But it didn’t worked. The reason was that there wasn’t enough current
provided to LED. <a class="reference external" href="https://docs.keeb.io/iris-build-guide-archive/#solder-led-support-components-40optional41">The old Iris build guide</a> says:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">470</span><span class="n">Ω</span> <span class="n">resistors</span> <span class="n">are</span> <span class="n">commonly</span> <span class="n">used</span><span class="p">,</span> <span class="n">but</span> <span class="n">this</span> <span class="n">value</span> <span class="n">might</span> <span class="n">vary</span><span class="p">,</span> <span class="n">based</span>
<span class="n">on</span> <span class="n">the</span> <span class="n">LEDs</span> <span class="n">you</span> <span class="n">use</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">amount</span> <span class="n">of</span> <span class="n">current</span> <span class="n">they</span> <span class="n">draw</span><span class="o">.</span>
</pre></div>
</div>
<p><a class="reference external" href="https://www.instagram.com/p/BsNHNU5Am8t/">Here’s what I unsuccessfully built, a black one</a> ….</p>
<img alt="a working failure built black" class="align-center" src="../_images/IMG_20190104_165042_047.jpg" />
<p>For LEDs to glow, <a class="reference external" href="https://qiita.com/natten/items/95a57ee77e1e66ba88e6">Iris rev2.5 ビルドメモ</a> uses 4.7Ω (
RK73H2ATTD471F ) for LED resistors…</p>
<p>But how much? What to buy??? <a class="reference external" href="https://www.reddit.com/r/MechanicalKeyboards/comments/7evx0x/iris_keyboard_with_led_backlighting/dq7v7y0/">This comment</a>
gives a clear description:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">USB</span> <span class="mi">2</span> <span class="n">spec</span> <span class="n">devices</span> <span class="n">are</span> <span class="n">supposed</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">their</span> <span class="n">power</span> <span class="n">draw</span> <span class="n">under</span> <span class="mi">500</span><span class="n">mA</span>
<span class="n">per</span> <span class="n">port</span><span class="p">,</span> <span class="ow">or</span> <span class="n">roughly</span> <span class="mf">2.5</span><span class="n">W</span><span class="o">.</span> <span class="n">Your</span> <span class="n">power</span> <span class="n">budget</span> <span class="n">should</span> <span class="n">also</span> <span class="n">include</span>
<span class="n">running</span> <span class="mi">2</span> <span class="n">pro</span><span class="o">-</span><span class="n">micros</span><span class="p">,</span> <span class="ow">and</span> <span class="n">possibly</span> <span class="n">RGB</span> <span class="n">underglow</span><span class="o">.</span> <span class="n">But</span> <span class="n">let</span><span class="s1">&#39;s say we</span>
<span class="n">budget</span> <span class="mi">50</span><span class="n">mA</span> <span class="n">per</span> <span class="n">each</span> <span class="n">half</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Iris</span><span class="o">.</span>

<span class="n">That</span><span class="s1">&#39;s a maximum of 56 keys, or 28 per half, so 28 LEDs for the left</span>
<span class="ow">and</span> <span class="n">right</span> <span class="n">sides</span><span class="o">.</span>

<span class="n">Using</span> <span class="n">this</span> <span class="n">website</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">ledcalc</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>

<span class="n">We</span> <span class="n">can</span> <span class="nb">input</span>

  <span class="mf">1.</span> <span class="nb">input</span> <span class="n">voltage</span> <span class="n">of</span> <span class="mi">5</span><span class="n">v</span> <span class="p">(</span><span class="n">USB</span><span class="p">)</span>
  <span class="mf">2.</span> <span class="n">voltage</span> <span class="n">drop</span> <span class="n">across</span> <span class="n">LEDs</span> <span class="o">-</span> <span class="n">the</span> <span class="n">forward</span> <span class="n">voltage</span> <span class="n">value</span> <span class="n">For</span> <span class="n">some</span> <span class="n">green</span> <span class="n">LEDs</span> <span class="n">I</span> <span class="n">bought</span> <span class="kn">from</span> <span class="nn">mehkee</span> <span class="n">this</span> <span class="n">value</span> <span class="ow">is</span> <span class="mi">3</span><span class="o">-</span><span class="mf">3.2</span><span class="n">v</span><span class="o">.</span> <span class="n">So</span> <span class="n">say</span> <span class="mf">3.1</span><span class="n">v</span>
  <span class="mf">3.</span> <span class="mi">28</span> <span class="n">LEDs</span><span class="o">.</span>

<span class="n">Now</span> <span class="n">playing</span> <span class="k">with</span> <span class="n">the</span> <span class="n">desired</span> <span class="n">LED</span> <span class="n">current</span><span class="p">,</span> <span class="n">the</span> <span class="n">nearest</span> <span class="n">value</span> <span class="ow">is</span> <span class="mf">1.9</span><span class="n">mA</span>
<span class="n">per</span> <span class="n">LED</span><span class="o">.</span> <span class="n">This</span> <span class="n">calculates</span> <span class="mf">1.2</span><span class="n">KOhm</span> <span class="n">resistor</span><span class="p">,</span> <span class="n">so</span> <span class="n">you</span> <span class="n">would</span> <span class="n">need</span> <span class="mi">28</span>
<span class="mf">1.2</span><span class="n">KOhm</span> <span class="n">resistors</span><span class="o">.</span> <span class="n">This</span> <span class="n">would</span> <span class="n">consume</span> <span class="mi">44</span><span class="n">mA</span> <span class="n">per</span> <span class="n">Iris</span> <span class="n">half</span> <span class="ow">or</span> <span class="mi">88</span><span class="n">mA</span> <span class="k">for</span>
<span class="n">both</span> <span class="n">sides</span><span class="o">.</span>

<span class="n">The</span> <span class="nb">next</span> <span class="n">nearest</span> <span class="n">resistor</span> <span class="n">value</span> <span class="n">takes</span> <span class="n">us</span> <span class="n">to</span> <span class="mi">54</span><span class="n">mA</span> <span class="k">with</span> <span class="n">a</span> <span class="mi">1</span><span class="n">KOhm</span>
<span class="n">resistor</span> <span class="n">which</span> <span class="n">would</span> <span class="n">use</span> <span class="mi">108</span><span class="n">mA</span> <span class="n">which</span> <span class="ow">is</span> <span class="n">slightly</span> <span class="n">above</span> <span class="n">our</span> <span class="n">power</span>
<span class="n">budget</span><span class="p">,</span> <span class="n">but</span> <span class="n">you</span> <span class="n">may</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">get</span> <span class="n">away</span> <span class="k">with</span> <span class="n">it</span><span class="o">.</span>

<span class="n">In</span> <span class="n">summary</span><span class="p">,</span> <span class="k">for</span> <span class="n">a</span> <span class="n">given</span> <span class="mf">1.8</span><span class="n">mm</span> <span class="ow">or</span> <span class="mi">2</span><span class="n">x3x4mm</span> <span class="n">LED</span> <span class="n">you</span> <span class="n">need</span> <span class="n">the</span> <span class="n">forward</span>
<span class="n">voltage</span> <span class="n">to</span> <span class="n">calculate</span> <span class="n">it</span><span class="s1">&#39;s power consumption.</span>
</pre></div>
</div>
<p>So I should have soldered right combination of resistors and LEDs.
LEDs require enough amount of current, equally power to glow, with
enough voltage. Those values are described as each spec.. if the
registors are too large enough current won’t be provided, but if it’s
too small, then too much current may break the system (possibly?).</p>
<p><a class="reference external" href="https://www.reddit.com/r/MechanicalKeyboards/comments/7lihur/help_questions_about_smd_leds_for_an_iris/drmkras/">A comment for another article</a>
gives a link to resistor value calculator. According to <a class="reference external" href="https://www.digikey.com/en/resources/conversion-calculators/conversion-calculator-led-series-resistor">the
calculator</a>
my configuration with 2x3x4 shows the registor value is only 100
Ohms. But I bought 470 Ohms, which provides &lt; 7mA current to LEDs.
The comment also describes the sense of scale:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">You</span> <span class="n">will</span> <span class="n">need</span> <span class="n">resistors</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">value</span> <span class="n">will</span> <span class="n">depend</span> <span class="n">on</span> <span class="n">what</span> <span class="n">LED</span><span class="s1">&#39;s you</span>
<span class="n">get</span><span class="o">.</span> <span class="mi">470</span> <span class="n">Ohm</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">safe</span> <span class="n">bet</span> <span class="n">but</span> <span class="n">can</span> <span class="n">vary</span> <span class="n">depending</span> <span class="n">on</span> <span class="n">the</span> <span class="nb">type</span> <span class="n">of</span> <span class="n">LED</span>
<span class="n">you</span> <span class="n">get</span><span class="o">.</span> <span class="n">There</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">formula</span> <span class="n">to</span> <span class="n">figure</span> <span class="n">it</span> <span class="n">out</span><span class="o">.</span> <span class="n">I</span> <span class="n">ended</span> <span class="n">up</span> <span class="n">using</span> <span class="mi">330</span><span class="s1">&#39;s</span>
<span class="n">on</span> <span class="n">mine</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">Yellow</span> <span class="n">LED</span><span class="s1">&#39;s are just bright enough. 470 was too dim</span>
</pre></div>
</div>
<p>Next time I’ll get another bunch of resistors, say, like 4.7Ω or 47Ω.</p>
</div>
<div class="section" id="wrist-rest">
<h2>Wrist Rest<a class="headerlink" href="#wrist-rest" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://www.instagram.com/p/Br2C0N5gomw/">https://www.instagram.com/p/Br2C0N5gomw/</a></p>
</div>
<div class="section" id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://qiita.com/natten/items/95a57ee77e1e66ba88e6">Iris rev2.5 ビルドメモ</a></li>
<li><a class="reference external" href="https://www.reddit.com/r/MechanicalKeyboards/comments/7evx0x/iris_keyboard_with_led_backlighting/">reddit: Iris keyboard with LED backlighting</a></li>
<li><a class="reference external" href="https://www.digikey.com/en/resources/conversion-calculators/conversion-calculator-led-series-resistor">LED Series Resistor Calculator</a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Iris build log</a><ul>
<li><a class="reference internal" href="#built-without-led">Built without LED</a></li>
<li><a class="reference internal" href="#low-profile">Low Profile</a></li>
<li><a class="reference internal" href="#lighting-with-led">Lighting with LED</a></li>
<li><a class="reference internal" href="#wrist-rest">Wrist Rest</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="zfs.html"
                        title="previous chapter">ZFS Memo</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="ergodox-ez.html"
                        title="next chapter">ErgoDox EZ</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/memo/iris.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ergodox-ez.html" title="ErgoDox EZ"
             >next</a> |</li>
        <li class="right" >
          <a href="zfs.html" title="ZFS Memo"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">kuenishi(7)</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2018, UENISHI Kota.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.3.
    </div>
  </body>
</html>